generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/.prisma/client"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Account {
  id                                       String            @id @default(cuid())
  userId                                   String
  currency                                 String
  balance                                  Decimal           @default(0) @db.Decimal(20, 8)
  type                                     String            @default("PERSONAL")
  rapydWalletId                            String?
  createdAt                                DateTime          @default(now())
  updatedAt                                DateTime          @updatedAt
  User                                     User              @relation(fields: [userId], references: [id])
  AccountActivity                          AccountActivity[]
  AppliedFee                               AppliedFee[]
  LedgerEntry                              LedgerEntry[]
  fundingSources                           AccountFundingSource[]
  ReferralReward                           ReferralReward[]
  Transfer_Transfer_fromAccountIdToAccount Transfer[]        @relation("Transfer_fromAccountIdToAccount")
  Transfer_Transfer_toAccountIdToAccount   Transfer[]        @relation("Transfer_toAccountIdToAccount")

  @@index([rapydWalletId])
  @@index([userId])
}

model AccountFundingSource {
  id          String   @id @default(cuid())
  accountId   String
  type        String
  provider    String
  providerRef String   @unique
  details     Json
  status      String   @default("ACTIVE")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  account Account @relation(fields: [accountId], references: [id])

  @@index([accountId])
}

model PaymentIntentRecord {
  id             String   @id @default(cuid())
  userId         String
  accountId      String
  provider       String
  providerRef    String   @unique
  idempotencyKey String   @unique
  amount         Decimal  @db.Decimal(20, 8)
  currency       String
  status         String
  clientSecret   String?
  metadata       Json?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([accountId])
  @@index([userId])
}

model AccountActivity {
  id        String   @id @default(cuid())
  accountId String
  userId    String
  action    String
  ipAddress String?
  metadata  Json?
  createdAt DateTime @default(now())
  Account   Account  @relation(fields: [accountId], references: [id])
  User      User     @relation(fields: [userId], references: [id])

  @@index([accountId])
  @@index([userId])
}

model AppliedFee {
  id                  String                @id @default(cuid())
  transactionId       String
  accountId           String
  amount              Decimal               @db.Decimal(20, 8)
  breakdownJson       String
  createdAt           DateTime              @default(now())
  Account             Account               @relation(fields: [accountId], references: [id])
  Transfer            Transfer              @relation(fields: [transactionId], references: [id])
  AppliedRuleInstance AppliedRuleInstance[]

  @@index([accountId])
  @@index([transactionId])
}

model AppliedRuleInstance {
  id             String     @id @default(cuid())
  appliedFeeId   String
  feeRuleId      String
  amount         Decimal    @db.Decimal(20, 8)
  percentageRate Decimal    @db.Decimal(10, 4)
  createdAt      DateTime   @default(now())
  AppliedFee     AppliedFee @relation(fields: [appliedFeeId], references: [id])
  FeeRule        FeeRule    @relation(fields: [feeRuleId], references: [id])

  @@index([appliedFeeId])
  @@index([feeRuleId])
}

model ChatEvent {
  id          String        @id @default(cuid())
  sessionId   String
  eventType   ChatEventType
  metadata    Json?
  createdAt   DateTime      @default(now())
  ChatSession ChatSession   @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([eventType])
  @@index([sessionId])
}

model ChatMessage {
  id          String      @id @default(cuid())
  sessionId   String
  senderId    String
  content     String
  type        String      @default("text")
  attachments Json?
  metadata    Json?
  isRead      Boolean     @default(false)
  readAt      DateTime?
  readBy      String?
  reactions   Json?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  ChatSession ChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([isRead])
  @@index([senderId])
  @@index([sessionId])
  @@index([type])
}

model ChatSession {
  id               String        @id @default(cuid())
  customerId       String
  agentId          String?
  status           ChatStatus    @default(WAITING)
  startedAt        DateTime      @default(now())
  endedAt          DateTime?
  metadata         Json?
  tags             String[]      @default([])
  priority         String?       @default("NORMAL")
  rating           Int?
  notes            String?
  lastMessageAt    DateTime?
  firstResponseAt  DateTime?
  resolvedAt       DateTime?
  customerMetadata Json?
  ChatEvent        ChatEvent[]
  ChatMessage      ChatMessage[]

  @@index([customerId])
  @@index([lastMessageAt])
  @@index([priority])
  @@index([startedAt])
  @@index([status, agentId])
  @@index([tags])
}

model ComplianceAlert {
  id          String   @id @default(cuid())
  type        String
  severity    String
  status      String   @default("PENDING")
  accountId   String?
  description String
  metadata    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Content {
  id              String           @id @default(cuid())
  title           String
  slug            String           @unique
  contentType     ContentType
  status          ContentStatus    @default(DRAFT)
  excerpt         String?
  content         String
  rawContent      Json?
  metaTitle       String?
  metaDescription String?
  metaKeywords    String[]
  canonicalUrl    String?
  category        String?
  tags            String[]
  featuredImage   String?
  mediaIds        String[]
  authorId        String
  authorName      String
  coAuthors       String[]
  publishedAt     DateTime?
  scheduledAt     DateTime?
  expiresAt       DateTime?
  version         Int              @default(1)
  parentId        String?
  viewCount       Int              @default(0)
  likeCount       Int              @default(0)
  isPublic        Boolean          @default(true)
  allowComments   Boolean          @default(false)
  language        String           @default("en")
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  ContentComment  ContentComment[]
  ContentMedia    ContentMedia[]
  ContentVersion  ContentVersion[]

  @@index([authorId])
  @@index([category])
  @@index([contentType])
  @@index([publishedAt])
  @@index([slug])
  @@index([status])
}

model ContentComment {
  id         String   @id @default(cuid())
  contentId  String
  authorId   String
  authorName String
  comment    String
  parentId   String?
  isApproved Boolean  @default(false)
  createdAt  DateTime @default(now())
  Content    Content  @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@index([contentId])
  @@index([parentId])
}

model ContentMedia {
  id         String   @id @default(cuid())
  contentId  String?
  fileName   String
  fileUrl    String
  fileType   String
  fileSize   Int
  altText    String?
  caption    String?
  uploadedBy String
  createdAt  DateTime @default(now())
  Content    Content? @relation(fields: [contentId], references: [id])

  @@index([contentId])
  @@index([uploadedBy])
}

model ContentVersion {
  id         String   @id @default(cuid())
  contentId  String
  version    Int
  title      String
  content    String
  excerpt    String?
  authorId   String
  authorName String
  createdAt  DateTime @default(now())
  Content    Content  @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@unique([contentId, version])
  @@index([contentId])
}

model Dispute {
  id              String             @id @default(cuid())
  escrowId        String
  raisedBy        String
  raisedByRole    EscrowPartyRole
  againstRole     EscrowPartyRole?
  reason          String
  description     String
  status          DisputeStatus      @default(OPEN)
  resolution      DisputeResolution?
  resolutionNotes String?
  resolvedBy      String?
  resolvedAt      DateTime?
  refundAmount    Decimal?           @db.Decimal(20, 8)
  releaseAmount   Decimal?           @db.Decimal(20, 8)
  respondByDate   DateTime?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  Escrow          Escrow             @relation(fields: [escrowId], references: [id], onDelete: Cascade)
  DisputeEvidence DisputeEvidence[]
  DisputeMessage  DisputeMessage[]

  @@index([escrowId])
  @@index([raisedBy])
  @@index([status])
}

model DisputeEvidence {
  id          String   @id @default(cuid())
  disputeId   String
  uploadedBy  String
  fileUrl     String
  fileName    String
  fileType    String?
  fileSize    Int?
  description String?
  createdAt   DateTime @default(now())
  Dispute     Dispute  @relation(fields: [disputeId], references: [id], onDelete: Cascade)

  @@index([disputeId])
}

model DisputeMessage {
  id         String          @id @default(cuid())
  disputeId  String
  senderId   String
  senderRole EscrowPartyRole
  message    String
  isInternal Boolean         @default(false)
  createdAt  DateTime        @default(now())
  Dispute    Dispute         @relation(fields: [disputeId], references: [id], onDelete: Cascade)

  @@index([disputeId])
}

model ErrorLog {
  id              String        @id @default(cuid())
  message         String
  errorType       String
  severity        ErrorSeverity @default(MEDIUM)
  status          ErrorStatus   @default(NEW)
  stack           String?
  context         Json?
  method          String?
  path            String?
  query           Json?
  ipAddress       String?
  userAgent       String?
  userId          String?
  correlationId   String?
  environment     String        @default("development")
  release         String?
  occurrenceCount Int           @default(1)
  firstSeenAt     DateTime      @default(now())
  lastSeenAt      DateTime      @default(now())
  resolvedBy      String?
  resolvedAt      DateTime?
  resolutionNotes String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([correlationId])
  @@index([createdAt])
  @@index([errorType])
  @@index([severity])
  @@index([status])
  @@index([userId])
}

model Escrow {
  id                 String              @id @default(cuid())
  title              String
  description        String?
  status             EscrowStatus        @default(DRAFT)
  currency           String
  totalAmount        Decimal             @db.Decimal(20, 8)
  platformFee        Decimal             @default(0) @db.Decimal(20, 8)
  platformFeePercent Decimal             @default(2.5) @db.Decimal(5, 2)
  escrowAccountId    String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  acceptedAt         DateTime?
  fundedAt           DateTime?
  completedAt        DateTime?
  expiresAt          DateTime?
  termsAccepted      Boolean             @default(false)
  autoReleaseEnabled Boolean             @default(false)
  autoReleaseDays    Int?
  Dispute            Dispute[]
  EscrowActivity     EscrowActivity[]
  EscrowDocument     EscrowDocument[]
  EscrowParty        EscrowParty[]
  EscrowTransaction  EscrowTransaction[]
  Milestone          Milestone[]

  @@index([createdAt])
  @@index([status])
}

model EscrowActivity {
  id              String           @id @default(cuid())
  escrowId        String
  milestoneId     String?
  type            String
  description     String
  performedBy     String?
  performedByRole EscrowPartyRole?
  metadata        Json?
  createdAt       DateTime         @default(now())
  Escrow          Escrow           @relation(fields: [escrowId], references: [id], onDelete: Cascade)
  Milestone       Milestone?       @relation(fields: [milestoneId], references: [id])

  @@index([createdAt])
  @@index([escrowId])
}

model EscrowDocument {
  id          String   @id @default(cuid())
  escrowId    String
  title       String
  description String?
  fileUrl     String
  fileName    String
  fileType    String?
  fileSize    Int?
  uploadedBy  String
  uploadedAt  DateTime @default(now())
  Escrow      Escrow   @relation(fields: [escrowId], references: [id], onDelete: Cascade)

  @@index([escrowId])
}

model EscrowParty {
  id          String          @id @default(cuid())
  escrowId    String
  userId      String?
  role        EscrowPartyRole
  email       String
  name        String?
  hasAccepted Boolean         @default(false)
  acceptedAt  DateTime?
  invitedAt   DateTime        @default(now())
  Escrow      Escrow          @relation(fields: [escrowId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([escrowId])
  @@index([userId])
}

model EscrowTransaction {
  id           String     @id @default(cuid())
  escrowId     String
  milestoneId  String?
  type         String
  amount       Decimal    @db.Decimal(20, 8)
  currency     String
  status       String
  transferId   String?
  accountId    String?
  description  String?
  metadata     Json?
  errorMessage String?
  processedBy  String?
  processedAt  DateTime?
  createdAt    DateTime   @default(now())
  Escrow       Escrow     @relation(fields: [escrowId], references: [id], onDelete: Cascade)
  Milestone    Milestone? @relation(fields: [milestoneId], references: [id])

  @@index([escrowId])
  @@index([milestoneId])
  @@index([status])
  @@index([type])
}

model ExternalTransaction {
  id                    String                    @id @default(cuid())
  userId                String
  accountId             String?
  provider              ExternalProvider
  providerTransactionId String?                   @unique
  type                  ExternalTransactionType
  status                ExternalTransactionStatus @default(PENDING)
  amount                Decimal                   @db.Decimal(20, 8)
  currency              String
  recipientDetails      Json?
  metadata              Json?
  errorMessage          String?
  webhookReceived       Boolean                   @default(false)
  webhookData           Json?
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt
  completedAt           DateTime?

  @@index([accountId])
  @@index([providerTransactionId])
  @@index([provider])
  @@index([status])
  @@index([userId])
}

model FeeRule {
  id                  String                @id @default(cuid())
  name                String
  description         String?
  feeType             FeeType
  transactionType     TransactionType
  currency            String
  fixedAmount         Decimal?              @db.Decimal(20, 8)
  percentageRate      Decimal?              @db.Decimal(10, 4)
  minAmount           Decimal?              @db.Decimal(20, 8)
  maxAmount           Decimal?              @db.Decimal(20, 8)
  country             String?
  isActive            Boolean               @default(true)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  AppliedRuleInstance AppliedRuleInstance[]
}

model Invoice {
  id                String        @id @default(cuid())
  invoiceNumber     String        @unique
  invoiceType       InvoiceType   @default(USER)
  userId            String
  businessId        String?
  createdBy         String
  issueDate         DateTime
  dueDate           DateTime
  status            InvoiceStatus @default(DRAFT)
  currency          String
  grandTotal        Decimal       @db.Decimal(20, 8)
  taxRate           Decimal       @default(0) @db.Decimal(5, 2)
  fromInfo          Json
  toInfo            Json
  items             Json
  paymentMethod     PaymentMethod @default(PAYVOST)
  manualBankDetails Json?
  notes             String?
  isPublic          Boolean       @default(false)
  publicUrl         String?
  pdfUrl            String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  paidAt            DateTime?

  @@index([businessId])
  @@index([createdBy])
  @@index([dueDate])
  @@index([invoiceNumber])
  @@index([invoiceType])
  @@index([isPublic])
  @@index([status])
  @@index([userId])
}

model KnowledgeBaseArticle {
  id                                          String        @id @default(cuid())
  title                                       String
  content                                     String
  slug                                        String        @unique
  category                                    String
  tags                                        String[]
  status                                      ArticleStatus @default(DRAFT)
  language                                    String        @default("en")
  views                                       Int           @default(0)
  helpfulCount                                Int           @default(0)
  createdById                                 String
  updatedById                                 String?
  publishedAt                                 DateTime?
  createdAt                                   DateTime      @default(now())
  updatedAt                                   DateTime      @updatedAt
  User_KnowledgeBaseArticle_createdByIdToUser User          @relation("KnowledgeBaseArticle_createdByIdToUser", fields: [createdById], references: [id])
  User_KnowledgeBaseArticle_updatedByIdToUser User?         @relation("KnowledgeBaseArticle_updatedByIdToUser", fields: [updatedById], references: [id])

  @@index([createdById])
  @@index([slug])
  @@index([status, category])
}

model LedgerEntry {
  id           String   @id @default(cuid())
  accountId    String
  amount       Decimal  @db.Decimal(20, 8)
  balanceAfter Decimal  @db.Decimal(20, 8)
  type         String
  description  String?
  referenceId  String?
  createdAt    DateTime @default(now())
  Account      Account  @relation(fields: [accountId], references: [id])

  @@index([accountId])
}

model Milestone {
  id                     String              @id @default(cuid())
  escrowId               String
  order                  Int
  title                  String
  description            String?
  amount                 Decimal             @db.Decimal(20, 8)
  status                 MilestoneStatus     @default(PENDING)
  amountFunded           Decimal             @default(0) @db.Decimal(20, 8)
  fundedAt               DateTime?
  requiresApproval       Boolean             @default(true)
  approvedBy             String?
  approvedAt             DateTime?
  releasedAt             DateTime?
  deliverableDescription String?
  deliverableSubmitted   Boolean             @default(false)
  deliverableUrl         String?
  deliverableSubmittedAt DateTime?
  autoReleaseDate        DateTime?
  createdAt              DateTime            @default(now())
  updatedAt              DateTime            @updatedAt
  EscrowActivity         EscrowActivity[]
  EscrowTransaction      EscrowTransaction[]
  Escrow                 Escrow              @relation(fields: [escrowId], references: [id], onDelete: Cascade)

  @@index([escrowId])
  @@index([status])
}

model RateAlert {
  id               String    @id @default(cuid())
  sourceCurrency   String
  targetCurrency   String
  targetRate       Decimal
  email            String?
  pushSubscription Json?
  isActive         Boolean   @default(true)
  notifiedAt       DateTime?
  notifiedCount    Int       @default(0)
  createdAt        DateTime  @default(now())
}

enum FxSnapshotStatus {
  ACCEPTED
  REJECTED
}

enum FxQuoteStatus {
  CREATED
  ACCEPTED
  EXPIRED
  CANCELLED
}

model FxRateSnapshot {
  id                String            @id @default(cuid())
  provider          String
  baseCurrency      String
  providerTimestamp DateTime
  fetchedAt         DateTime          @default(now())
  ratesJson         Json
  status            FxSnapshotStatus  @default(ACCEPTED)
  rejectReason      String?
  createdAt         DateTime          @default(now())
  FxQuote           FxQuote[]

  @@index([provider, status])
  @@index([fetchedAt])
}

model FxQuote {
  id              String        @id @default(cuid())
  userId          String
  fromAccountId   String
  toAccountId     String
  fromCurrency    String
  toCurrency      String
  fromAmount      Decimal       @db.Decimal(20, 8)
  toAmount        Decimal       @db.Decimal(20, 8)
  rateSnapshotId  String
  midRate         Decimal       @db.Decimal(20, 8)
  feeTotal        Decimal       @db.Decimal(20, 8)
  feeBreakdownJson Json
  expiresAt       DateTime
  status          FxQuoteStatus @default(CREATED)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  acceptedAt      DateTime?
  cancelledAt     DateTime?
  FxRateSnapshot  FxRateSnapshot @relation(fields: [rateSnapshotId], references: [id])

  @@index([userId])
  @@index([rateSnapshotId])
  @@index([status, expiresAt])
}

model Recipient {
  id            String   @id @default(cuid())
  userId        String
  name          String
  email         String?
  phone         String?
  payvostUserId String?
  bankName      String?
  accountNumber String?
  swiftCode     String?
  currency      String?
  country       String?
  type          String   @default("EXTERNAL")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  User          User     @relation(fields: [userId], references: [id])

  @@index([payvostUserId])
  @@index([userId])
}

model Referral {
  id                             String           @id @default(cuid())
  referrerId                     String
  referredId                     String           @unique
  referralCodeId                 String
  tier                           ReferralTier     @default(TIER_1)
  parentReferralId               String?
  isActive                       Boolean          @default(true)
  referredKycStatus              String?
  firstTransactionAt             DateTime?
  createdAt                      DateTime         @default(now())
  updatedAt                      DateTime         @updatedAt
  Referral                       Referral?        @relation("ReferralToReferral", fields: [parentReferralId], references: [id])
  other_Referral                 Referral[]       @relation("ReferralToReferral")
  ReferralCode                   ReferralCode     @relation(fields: [referralCodeId], references: [id])
  User_Referral_referredIdToUser User             @relation("Referral_referredIdToUser", fields: [referredId], references: [id])
  User_Referral_referrerIdToUser User             @relation("Referral_referrerIdToUser", fields: [referrerId], references: [id])
  ReferralReward                 ReferralReward[]

  @@index([isActive])
  @@index([referralCodeId])
  @@index([referredId])
  @@index([referrerId])
  @@index([tier])
}

model ReferralCampaign {
  id                   String    @id @default(cuid())
  name                 String
  description          String?
  isActive             Boolean   @default(true)
  signupBonus          Decimal?  @db.Decimal(20, 8)
  signupCurrency       String?
  firstTxBonus         Decimal?  @db.Decimal(20, 8)
  firstTxCurrency      String?
  firstTxMinAmount     Decimal?  @db.Decimal(20, 8)
  tier2Percentage      Decimal?  @db.Decimal(5, 2)
  tier3Percentage      Decimal?  @db.Decimal(5, 2)
  minKycLevel          String?
  eligibleCountries    String[]
  excludedCountries    String[]
  maxReferralsPerUser  Int?
  maxRewardPerUser     Decimal?  @db.Decimal(20, 8)
  maxRewardPerCampaign Decimal?  @db.Decimal(20, 8)
  startDate            DateTime
  endDate              DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  @@index([isActive])
  @@index([startDate, endDate])
}

model ReferralCode {
  id         String     @id @default(cuid())
  userId     String     @unique
  code       String     @unique
  isActive   Boolean    @default(true)
  usageCount Int        @default(0)
  createdAt  DateTime   @default(now())
  expiresAt  DateTime?
  Referral   Referral[]
  User       User       @relation(fields: [userId], references: [id])

  @@index([code])
  @@index([userId])
}

model ReferralReward {
  id              String               @id @default(cuid())
  referralId      String
  userId          String
  rewardType      ReferralRewardType
  amount          Decimal              @db.Decimal(20, 8)
  currency        String
  status          ReferralRewardStatus @default(PENDING)
  tier            ReferralTier
  description     String?
  metadata        Json?
  accountId       String?
  transferId      String?
  paidAt          DateTime?
  approvedBy      String?
  approvedAt      DateTime?
  cancelledReason String?
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  expiresAt       DateTime?
  Account         Account?             @relation(fields: [accountId], references: [id])
  Referral        Referral             @relation(fields: [referralId], references: [id])
  User            User                 @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([referralId])
  @@index([rewardType])
  @@index([status])
  @@index([tier])
  @@index([userId])
}

model SavedReply {
  id         String   @id @default(cuid())
  title      String
  content    String
  category   String?
  createdBy  String
  usageCount Int      @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([category])
  @@index([createdBy])
}

model ServiceHealthCheck {
  id           String        @id @default(cuid())
  serviceName  String
  status       ServiceStatus
  responseTime Int?
  uptime       Decimal?      @db.Decimal(5, 2)
  lastChecked  DateTime      @default(now())
  details      Json?
  errorMessage String?
  createdAt    DateTime      @default(now())

  @@index([lastChecked])
  @@index([serviceName])
  @@index([serviceName, lastChecked])
  @@index([status])
}

model SupportTicket {
  id                                    String             @id @default(cuid())
  ticketNumber                          String             @unique
  subject                               String
  description                           String
  status                                TicketStatus       @default(OPEN)
  priority                              TicketPriority     @default(MEDIUM)
  category                              String
  customerId                            String
  assignedToId                          String?
  createdById                           String?
  tags                                  String[]
  metadata                              Json?
  slaDeadline                           DateTime?
  firstResponseAt                       DateTime?
  resolvedAt                            DateTime?
  closedAt                              DateTime?
  createdAt                             DateTime           @default(now())
  updatedAt                             DateTime           @updatedAt
  User_SupportTicket_assignedToIdToUser User?              @relation("SupportTicket_assignedToIdToUser", fields: [assignedToId], references: [id])
  User_SupportTicket_createdByIdToUser  User?              @relation("SupportTicket_createdByIdToUser", fields: [createdById], references: [id])
  User_SupportTicket_customerIdToUser   User               @relation("SupportTicket_customerIdToUser", fields: [customerId], references: [id])
  TicketAttachment                      TicketAttachment[]
  TicketMessage                         TicketMessage[]

  @@index([assignedToId])
  @@index([createdAt])
  @@index([customerId])
  @@index([status, priority])
  @@index([ticketNumber])
}

model SystemIncident {
  id               String           @id @default(cuid())
  title            String
  description      String
  status           IncidentStatus   @default(INVESTIGATING)
  severity         IncidentSeverity @default(MEDIUM)
  affectedServices String[]
  startedAt        DateTime         @default(now())
  resolvedAt       DateTime?
  metadata         Json?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  @@index([severity])
  @@index([startedAt])
  @@index([status])
  @@index([status, severity])
}

model TicketAttachment {
  id            String        @id @default(cuid())
  ticketId      String
  fileName      String
  fileUrl       String
  fileSize      Int
  mimeType      String
  uploadedById  String
  createdAt     DateTime      @default(now())
  SupportTicket SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  User          User          @relation(fields: [uploadedById], references: [id])

  @@index([ticketId])
  @@index([uploadedById])
}

model TicketMessage {
  id            String        @id @default(cuid())
  ticketId      String
  authorId      String
  content       String
  type          MessageType   @default(PUBLIC_REPLY)
  isRead        Boolean       @default(false)
  createdAt     DateTime      @default(now())
  User          User          @relation(fields: [authorId], references: [id])
  SupportTicket SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([authorId])
  @@index([createdAt])
  @@index([ticketId])
}

model Transfer {
  id                                      String          @id @default(cuid())
  fromAccountId                           String
  toAccountId                             String
  amount                                  Decimal         @db.Decimal(20, 8)
  currency                                String
  targetAmount                            Decimal?        @db.Decimal(20, 8)
  targetCurrency                          String?
  exchangeRate                            Decimal?        @db.Decimal(20, 8)
  status                                  String
  type                                    TransactionType
  idempotencyKey                          String?         @unique
  description                             String?
  createdAt                               DateTime        @default(now())
  AppliedFee                              AppliedFee[]
  Account_Transfer_fromAccountIdToAccount Account         @relation("Transfer_fromAccountIdToAccount", fields: [fromAccountId], references: [id])
  Account_Transfer_toAccountIdToAccount   Account         @relation("Transfer_toAccountIdToAccount", fields: [toAccountId], references: [id])

  @@index([fromAccountId])
  @@index([toAccountId])
}

model User {
  id                                                          String                 @id
  email                                                       String                 @unique
  name                                                        String?
  role                                                        String                 @default("user")
  kycStatus                                                   String                 @default("pending")
  createdAt                                                   DateTime               @default(now())
  updatedAt                                                   DateTime
  country                                                     String?
  userTier                                                    String                 @default("STANDARD")
  twoFactorEnabled                                            Boolean                @default(false)
  twoFactorMethod                                             String?
  twoFactorSecret                                             String?
  twoFactorPhone                                              String?
  twoFactorBackupCodes                                        String[]
  twoFactorVerified                                           Boolean                @default(false)
  password                                                    String?
  Account                                                     Account[]
  AccountActivity                                             AccountActivity[]
  KnowledgeBaseArticle_KnowledgeBaseArticle_createdByIdToUser KnowledgeBaseArticle[] @relation("KnowledgeBaseArticle_createdByIdToUser")
  KnowledgeBaseArticle_KnowledgeBaseArticle_updatedByIdToUser KnowledgeBaseArticle[] @relation("KnowledgeBaseArticle_updatedByIdToUser")
  Recipient                                                   Recipient[]
  Referral_Referral_referredIdToUser                          Referral?              @relation("Referral_referredIdToUser")
  Referral_Referral_referrerIdToUser                          Referral[]             @relation("Referral_referrerIdToUser")
  ReferralCode                                                ReferralCode?
  ReferralReward                                              ReferralReward[]
  SupportTicket_SupportTicket_assignedToIdToUser              SupportTicket[]        @relation("SupportTicket_assignedToIdToUser")
  SupportTicket_SupportTicket_createdByIdToUser               SupportTicket[]        @relation("SupportTicket_createdByIdToUser")
  SupportTicket_SupportTicket_customerIdToUser                SupportTicket[]        @relation("SupportTicket_customerIdToUser")
  TicketAttachment                                            TicketAttachment[]
  TicketMessage                                               TicketMessage[]
}

enum ArticleStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum ChatEventType {
  PAGE_VISIT
  WIDGET_OPENED
  MESSAGE_SENT
  MESSAGE_RECEIVED
  SESSION_STARTED
  SESSION_ENDED
  AGENT_ASSIGNED
  ESCALATED
  RATED
}

enum ChatStatus {
  WAITING
  ACTIVE
  ENDED
}

enum ContentStatus {
  DRAFT
  REVIEW
  PUBLISHED
  ARCHIVED
  SCHEDULED
}

enum ContentType {
  BLOG
  PRESS_RELEASE
  DOCUMENTATION
  KNOWLEDGE_BASE
}

enum DisputeResolution {
  REFUND_BUYER
  RELEASE_SELLER
  PARTIAL_REFUND
  CUSTOM_SPLIT
}

enum DisputeStatus {
  OPEN
  UNDER_REVIEW
  EVIDENCE_SUBMITTED
  AWAITING_DECISION
  RESOLVED_BUYER
  RESOLVED_SELLER
  RESOLVED_PARTIAL
  CLOSED
}

enum ErrorSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum ErrorStatus {
  NEW
  ACKNOWLEDGED
  RESOLVED
  IGNORED
}

enum EscrowPartyRole {
  BUYER
  SELLER
  MEDIATOR
  ADMIN
}

enum EscrowStatus {
  DRAFT
  AWAITING_ACCEPTANCE
  AWAITING_FUNDING
  FUNDED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  DISPUTED
  REFUNDED
}

enum ExternalProvider {
  RELOADLY
  RAPYD
  PAYSTACK
  FLUTTERWAVE
  STRIPE
}

enum ExternalTransactionStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
}

enum ExternalTransactionType {
  AIRTIME_TOPUP
  DATA_BUNDLE
  GIFT_CARD
  BILL_PAYMENT
  PAYMENT
  PAYOUT
  VIRTUAL_ACCOUNT_DEPOSIT
  WALLET_TRANSFER
  CARD_ISSUANCE
}

enum FeeType {
  FIXED
  PERCENTAGE
  HYBRID
}

enum IncidentSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum IncidentStatus {
  INVESTIGATING
  MONITORING
  RESOLVED
}

enum InvoiceStatus {
  DRAFT
  PENDING
  PAID
  OVERDUE
  CANCELLED
}

enum InvoiceType {
  USER
  BUSINESS
}

enum MessageType {
  PUBLIC_REPLY
  INTERNAL_NOTE
}

enum MilestoneStatus {
  PENDING
  AWAITING_FUNDING
  FUNDED
  UNDER_REVIEW
  APPROVED
  RELEASED
  DISPUTED
  CANCELLED
}

enum PaymentMethod {
  PAYVOST
  MANUAL
  STRIPE
  RAPYD
}

enum ReferralRewardStatus {
  PENDING
  APPROVED
  PAID
  CANCELLED
  EXPIRED
}

enum ReferralRewardType {
  SIGNUP_BONUS
  FIRST_TRANSACTION
  MONTHLY_ACTIVE
  TIER_UPGRADE
  CUSTOM
}

enum ReferralTier {
  TIER_1
  TIER_2
  TIER_3
}

enum ServiceStatus {
  OPERATIONAL
  DEGRADED_PERFORMANCE
  MAJOR_OUTAGE
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TicketStatus {
  OPEN
  PENDING
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum TransactionType {
  INTERNAL_TRANSFER
  EXTERNAL_TRANSFER
  CARD_PAYMENT
  ATM_WITHDRAWAL
  DEPOSIT
  CURRENCY_EXCHANGE
}
