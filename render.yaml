services:
  # Main Backend API Gateway (includes Support Service and all other services)
  - type: web
    name: payvost-backend-gateway
    env: node
    region: oregon
    plan: starter
    buildCommand: cd backend && npm install --include=dev && npm run build
    startCommand: cd backend && npm start
    envVars:
      - key: PORT
        value: 3001
      - key: DATABASE_URL
        sync: false  # Set to your Neon database connection string in Render Dashboard
      - key: FIREBASE_SERVICE_ACCOUNT_KEY
        sync: false  # Firebase service account JSON (as string)
      - key: FIREBASE_DATABASE_URL
        sync: false  # Optional: Firebase Realtime Database URL
      - key: FRONTEND_URL
        sync: false  # Comma-separated list of allowed origins (e.g., "https://www.payvost.com,https://payvost.com")
      - key: NODE_ENV
        value: production
      - key: REDIS_URL
        sync: false  # Optional: Redis connection URL if using Redis
      - key: MAILGUN_API_KEY
        sync: false  # Optional: If using Mailgun for emails
      - key: MAILGUN_DOMAIN
        sync: false  # Optional: Mailgun domain
      - key: TWILIO_ACCOUNT_SID
        sync: false  # Optional: If using Twilio for SMS
      - key: TWILIO_AUTH_TOKEN
        sync: false  # Optional: Twilio auth token
      - key: TWILIO_FROM_NUMBER
        sync: false  # Optional: Twilio phone number
      - key: JWT_SECRET
        sync: false  # Optional: JWT secret for token signing

  # Rate Alert Monitor Service (Background Worker / Cron Job)
  - type: web
    name: payvost-rate-alert-service
    env: node
    region: oregon
    plan: starter
    buildCommand: cd backend/services/rate-alert-service && npm install --include=dev && npm run build
    startCommand: cd backend/services/rate-alert-service && npm start
    envVars:
      - key: RATE_ALERT_SERVICE_PORT
        value: 3009
      - key: DATABASE_URL
        sync: false  # Set to your Neon database connection string in Render Dashboard
      - key: MAILGUN_API_KEY
        sync: false
      - key: MAILGUN_DOMAIN
        sync: false
      - key: VAPID_PUBLIC_KEY
        sync: false
      - key: VAPID_PRIVATE_KEY
        sync: false
      - key: VAPID_EMAIL
        value: alerts@payvost.com
      - key: OPEN_EXCHANGE_RATES_APP_ID
        sync: false
      - key: AUTO_RUN_ON_STARTUP
        value: "false"
      - key: NODE_ENV
        value: production

  # Currency Service
  - type: web
    name: payvost-currency-service
    env: node
    region: oregon
    plan: starter
    buildCommand: cd backend/services/currency-service && npm install --include=dev && npm run build
    startCommand: cd backend/services/currency-service && npm start
    envVars:
      - key: CURRENCY_SERVICE_PORT
        value: 3010
      - key: OPEN_EXCHANGE_RATES_APP_ID
        sync: false
      - key: NODE_ENV
        value: production

  # Fraud Detection Service
  - type: web
    name: payvost-fraud-service
    env: node
    region: oregon
    plan: starter
    buildCommand: cd backend/services/fraud-service && npm install --include=dev && npm run build
    startCommand: cd backend/services/fraud-service && npm start
    envVars:
      - key: FRAUD_SERVICE_PORT
        value: 3011
      - key: DATABASE_URL
        sync: false  # Set to your Neon database connection string in Render Dashboard
      - key: INTERNAL_API_KEY
        sync: false
      - key: NODE_ENV
        value: production

  # Core Banking Service
  - type: web
    name: payvost-core-banking-service
    env: node
    region: oregon
    plan: starter
    buildCommand: cd backend/services/core-banking-service && npm install --include=dev && npm run build
    startCommand: cd backend/services/core-banking-service && npm start
    envVars:
      - key: CORE_BANKING_SERVICE_PORT
        value: 3012
      - key: DATABASE_URL
        sync: false  # Set to your Neon database connection string in Render Dashboard
      - key: INTERNAL_API_KEY
        sync: false
      - key: NODE_ENV
        value: production

  # Existing services (already deployed)
  # - payvost-web-hook-services
  # - payvost-admin-stat-service
  # - payvost-pdf-generator
  # - payvost-email-service

# Optional: Cron Job for Rate Alert Monitor (alternative to always-on service)
# Uncomment if you prefer scheduled execution instead of always-on service
# cronJobs:
#   - name: payvost-rate-alert-cron
#     schedule: "*/15 * * * *"  # Every 15 minutes
#     service: payvost-rate-alert-service
#     command: curl -X POST http://localhost:3009/run

